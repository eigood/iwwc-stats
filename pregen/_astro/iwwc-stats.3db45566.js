let u=[],p=(t,i)=>{let r=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},l:i||0,lc:0,listen(n,a){return s.lc=r.push(n,a||s.l)/2,()=>{let e=r.indexOf(n);~e&&(r.splice(e,2),--s.lc||s.off())}},notify(n){let a=!u.length;for(let e=0;e<r.length;e+=2)u.push(r[e],r[e+1],s.value,n);if(a){for(let e=0;e<u.length;e+=4){let o;for(let l=e+1;!o&&(l+=4)<u.length;)u[l]<u[e+1]&&(o=u.push(u[e],u[e+1],u[e+2],u[e+3]));o||u[e](u[e+2],u[e+3])}u.length=0}},off(){},set(n){s.value!==n&&(s.value=n,s.notify())},subscribe(n,a){let e=s.listen(n,a);return n(s.value),e},value:t};return s};let T=(t,i,r,s)=>(t.events=t.events||{},t.events[r+10]||(t.events[r+10]=s(n=>{t.events[r].reduceRight((a,e)=>(e(a),a),{shared:{},...n})})),t.events[r]=t.events[r]||[],t.events[r].push(i),()=>{let n=t.events[r],a=n.indexOf(i);n.splice(a,1),n.length||(delete t.events[r],t.events[r+10](),delete t.events[r+10])}),N=1e3,v=(t,i)=>T(t,s=>{let n=i(s);n&&t.events[6].push(n)},5,s=>{let n=t.listen;t.listen=(...e)=>(!t.lc&&!t.active&&(t.active=!0,s()),n(...e));let a=t.off;return t.events[6]=[],t.off=()=>{a(),setTimeout(()=>{if(t.active&&!t.lc){t.active=!1;for(let e of t.events[6])e();t.events[6]=[]}},N)},()=>{t.listen=n,t.off=a}}),g=(t,i)=>{Array.isArray(t)||(t=[t]);let r,s=()=>{let a=t.map(e=>e.get());(r===void 0||a.some((e,o)=>e!==r[o]))&&(r=a,n.set(i(...a)))},n=p(void 0,Math.max(...t.map(a=>a.l))+1);return v(n,()=>{let a=t.map(e=>e.listen(s,n.l));return s(),()=>{for(let e of a)e()}}),n};const d=p({}),O="https://eigood.github.io/iwwc-stats/pregen/data/iwwc-stats.json",w=async()=>{const t=await fetch(O).then(i=>i.json());d.set(t)},U={weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"numeric",second:"numeric"},h={weekday:"short",year:"numeric",month:"short",day:"numeric"},R=g(d,t=>{const{group:{endDate:i,lastRefresh:r,startDate:s,...n}={}}=t,a={...n,endDate:new Date(i),lastRefresh:new Date(r),startDate:new Date(s)};return a.$formatted={endDate:a.endDate.toLocaleString(navigator.language,h),lastRefresh:a.lastRefresh.toLocaleString(navigator.language,U),startDate:a.startDate.toLocaleString(navigator.language,h)},console.log("computed:groupInfo",a),a}),D=g(d,t=>{const{data:{statKeys:i=[],agents:r=[]}={}}=t;return r.reduce((s,n)=>{const[a,...e]=n,o=s[a]=i.reduce((l,c,f)=>{const m=l[c]=e[f];return Number.isInteger(m)?l.$formatted[c]=m.toLocaleString(navigator.language,{useGrouping:!0}):l.$formatted[c]=m,l},{$formatted:{}});return o.last_submit&&(o.last_submit=new Date(o.last_submit)),s},{})}),M=g(d,t=>{const{data:{factionCounts:i}={}}=t;return i}),E=g(d,t=>{const{data:{stats:i=[]}={}}=t;return i.reduce((r,s)=>{const{statName:n,statRows:a,sumAgents:e,...o}=s;return r[n]={...o,sumAgents:Object.entries(e).reduce((l,[c,f])=>(l[c]=f,l.$formatted[c]=f.toLocaleString(navigator.language,{useGrouping:!0}),l),{$formatted:{}}),statRows:a.reduce((l,[c,f])=>(l.push({agentName:c,position:f}),l),[])},r},{})});export{R as $,M as a,D as b,E as c,d,w as r};
