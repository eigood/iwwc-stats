let l=[],T=(t,i)=>{let s=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},l:i||0,lc:0,listen(n,a){return r.lc=s.push(n,a||r.l)/2,()=>{let e=s.indexOf(n);~e&&(s.splice(e,2),--r.lc||r.off())}},notify(n){let a=!l.length;for(let e=0;e<s.length;e+=2)l.push(s[e],s[e+1],r.value,n);if(a){for(let e=0;e<l.length;e+=4){let o;for(let u=e+1;!o&&(u+=4)<l.length;)l[u]<l[e+1]&&(o=l.push(l[e],l[e+1],l[e+2],l[e+3]));o||l[e](l[e+2],l[e+3])}l.length=0}},off(){},set(n){r.value!==n&&(r.value=n,r.notify())},subscribe(n,a){let e=r.listen(n,a);return n(r.value),e},value:t};return r};let p=(t,i,s,r)=>(t.events=t.events||{},t.events[s+10]||(t.events[s+10]=r(n=>{t.events[s].reduceRight((a,e)=>(e(a),a),{shared:{},...n})})),t.events[s]=t.events[s]||[],t.events[s].push(i),()=>{let n=t.events[s],a=n.indexOf(i);n.splice(a,1),n.length||(delete t.events[s],t.events[s+10](),delete t.events[s+10])}),N=1e3,v=(t,i)=>p(t,r=>{let n=i(r);n&&t.events[6].push(n)},5,r=>{let n=t.listen;t.listen=(...e)=>(!t.lc&&!t.active&&(t.active=!0,r()),n(...e));let a=t.off;return t.events[6]=[],t.off=()=>{a(),setTimeout(()=>{if(t.active&&!t.lc){t.active=!1;for(let e of t.events[6])e();t.events[6]=[]}},N)},()=>{t.listen=n,t.off=a}}),g=(t,i)=>{Array.isArray(t)||(t=[t]);let s,r=()=>{let a=t.map(e=>e.get());(s===void 0||a.some((e,o)=>e!==s[o]))&&(s=a,n.set(i(...a)))},n=T(void 0,Math.max(...t.map(a=>a.l))+1);return v(n,()=>{let a=t.map(e=>e.listen(r,n.l));return r(),()=>{for(let e of a)e()}}),n};const d=T({}),U={}.IWWC_STATS_URL||"/data/iwwc-stats.json",R=async()=>{const t=await fetch(U).then(i=>i.json());d.set(t)},O={weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"numeric",second:"numeric"},h={weekday:"short",year:"numeric",month:"short",day:"numeric"},w=g(d,t=>{const{group:{endDate:i,lastRefresh:s,startDate:r,...n}={}}=t,a={...n,endDate:new Date(i),lastRefresh:new Date(s),startDate:new Date(r)};return a.$formatted={endDate:a.endDate.toLocaleString(navigator.language,h),lastRefresh:a.lastRefresh.toLocaleString(navigator.language,O),startDate:a.startDate.toLocaleString(navigator.language,h)},console.log("computed:groupInfo",a),a}),D=g(d,t=>{const{data:{statKeys:i=[],agents:s=[]}={}}=t;return s.reduce((r,n)=>{const[a,...e]=n,o=r[a]=i.reduce((u,f,c)=>{const m=u[f]=e[c];return Number.isInteger(m)?u.$formatted[f]=m.toLocaleString(navigator.language,{useGrouping:!0}):u.$formatted[f]=m,u},{$formatted:{}});return o.last_submit&&(o.last_submit=new Date(o.last_submit)),r},{})}),M=g(d,t=>{const{data:{factionCounts:i}={}}=t;return i}),E=g(d,t=>{const{data:{stats:i=[]}={}}=t;return i.reduce((s,r)=>{const{statName:n,statRows:a,sumAgents:e,...o}=r;return s[n]={...o,sumAgents:Object.entries(e).reduce((u,[f,c])=>(u[f]=c,u.$formatted[f]=c.toLocaleString(navigator.language,{useGrouping:!0}),u),{$formatted:{}}),statRows:a.reduce((u,[f,c])=>(u.push({agentName:f,position:c}),u),[])},s},{})});export{w as $,M as a,D as b,E as c,d,R as r};
